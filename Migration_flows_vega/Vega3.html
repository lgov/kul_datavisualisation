<!DOCTYPE html>
<html>
  <head>
    <title>Embedding Vega-Lite</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>
  </head>
  <body>
    <div id="vis"></div>

    <script type="text/javascript">
      var yourVlSpec = {
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 900,
  "height": 560,
  "padding": {"top": 0, "left": 0, "right": 0, "bottom": 0},
"signals": [
{
  "name": "hover",
  "value": "null",
  "on": [
    {"events": "symbol:mouseover", "update": "datum"},
    {"events": "symbol:mouseout", "update": "null"}
  ]
},
{
  "name": "title",
  "value": "Migration",
  "update": "hover ? hover.base_country_name + ' (' + hover.base_country_code +')' : 'Migration 2015'"
}
],
  "data": [
  {
    "name": "states",
    "url": "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json",
    "format": {"type": "topojson", "feature": "countries"},
    "transform": [
      {
        "type": "geopath",
        "projection": "projection"
      }
    ]
  },

{
"name": "Migration",
"url": "https://raw.githubusercontent.com/RncDS/Bubble/main/Migration2.csv",
"format": {"type": "csv", "parse": "auto"},
"transform": [
  {
    "type": "aggregate",
    "groupby": ["origin"],
    "fields": ["count"], "ops": ["sum"], "as": ["Migration"]
  }
]
},


  {
"name": "Countries",
"url": "https://raw.githubusercontent.com/RncDS/Bubble/main/Countries.csv",
"format": {"type": "csv"},
"transform": [
      {
    "type": "lookup",
    "from": "Migration", "key": "origin",
    "fields": ["base_country_code"], "as": ["Migration"]
  },
  {
    "type": "filter",
    "expr": "datum.Migration != null"
  },
  {
    "type": "geopoint",
    "projection": "projection",
    "fields": ["longitude", "latitude"]
  },
  {
    "type": "filter",
    "expr": "datum.x != null && datum.y != null"
  },
  {
    "type": "collect", "sort": {
      "field": "Migration.Migration",
      "order": "descending"
    }
  }
]
},
{
"name": "routes",
"url": "https://raw.githubusercontent.com/RncDS/Bubble/main/Migration2.csv",
"format": {"type": "csv", "parse": "auto"},
"transform": [
   {
    "type": "filter",
    "expr": "hover && hover.base_country_code == datum.origin"
  },
  {
    "type": "lookup",
    "from": "Countries", "key": "base_country_code",
    "fields": ["origin", "destination"], "as": ["source", "target"]
  },
  {
    "type": "filter",
    "expr": "datum.source && datum.target"
  },
  {
    "type": "linkpath",
    "shape": "curve"
  }
]
}
],
"scales": [
{
  "name": "size",
  "type": "linear",
  "domain": {"data": "Migration", "field": "Migration"},
  "range": [16, 600]
},
  {
  "name": "width",
  "type": "linear",
  "domain": {"data": "Migration", "field": "Migration"},
  "range": [0, 15]
},
{
    "name": "color",
    "type": "ordinal",
    "domain": ["Pos", "Neg"],
    "range": ["#0A2F51", "#9F2005"]
  }
],
  "projections": [
{
  "name": "projection",
  "type": "mercator",
  "rotate": [-50,0,0],
  "scale": 200,
  "translate": [{"signal": "width / 2"}, {"signal": "height / 2"}]
}
],
"marks": [
{
  "type": "path",
  "from": {"data": "states"},
  "encode": {
    "enter": {
      "fill": {"value": "#B8C7CF"},
      "stroke": {"value": "#686868"}
    },
    "update": {
      "path": {"field": "path"}
    }
  }
},
{
"type": "symbol",
"from": {"data": "Countries"},
"encode": {
  "enter": {
    "size": {"scale": "size", "field": "Migration.Migration"},
    "fill": {"value": "#137177"},
    "fillOpacity": {"value": 0.8},
    "stroke": {"value": "white"},
    "strokeWidth": {"value": 1.0}
  },
  "update": {
    "x": {"field": "x"},
    "y": {"field": "y"}
  }
}
},
{
"type": "text",
"interactive": false,
"encode": {
  "enter": {
    "x": {"signal": "width", "offset": -5},
    "y": {"value": 0},
    "fill": {"value": "black"},
    "fontSize": {"value": 20},
    "align": {"value": "right"}
  },
  "update": {
    "text": {"signal": "title"}
  }
}
},
{
"type": "path",
"interactive": false,
"from": {"data": "routes"},
"encode": {
  "enter": {
    "path": {"field": "path"},
    "stroke": {"scale": "color", "field": "cat"},
    "strokeOpacity": {"value": 0.20},
    "strokeWidth": {"scale": "width", "field": "count"}
  }
}
}
]}
;
      vegaEmbed('#vis', yourVlSpec);
    </script>
  </body>
</html>